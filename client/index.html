<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>BeerMugGame - –û–Ω–ª–∞–π–Ω –±–∏—Ç–≤–∞ –ø–∏–≤–Ω—ã—Ö –∫—Ä—É–∂–µ–∫</title>
  <meta name="description" content="–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –æ–Ω–ª–∞–π–Ω –∏–≥—Ä–∞ —Å –ø–∏–≤–Ω—ã–º–∏ –∫—Ä—É–∂–∫–∞–º–∏">
  
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body { 
      margin: 0; 
      background: #1a1a2e; 
      color: #fff; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      touch-action: manipulation;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      position: fixed;
      width: 100vw;
      height: 100vh;
    }

    #game-container { 
      width: 100vw; 
      height: 100vh; 
      background: #16213e; 
      position: relative; 
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ */
    #join { 
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(145deg, rgba(0, 0, 0, 0.9), rgba(40, 40, 60, 0.9));
      padding: 30px;
      border-radius: 15px;
      z-index: 1000;
      width: 90%;
      max-width: 350px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 215, 0, 0.3);
    }

    #join h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #FFD700;
      font-size: 24px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }

    #join input, #join button {
      padding: 15px;
      margin: 10px 0;
      border: none;
      border-radius: 8px;
      width: 100%;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    #join input {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      border: 2px solid transparent;
    }

    #join input:focus {
      outline: none;
      border-color: #FFD700;
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
    }

    #join button {
      background: linear-gradient(145deg, #4CAF50, #45a049);
      color: white;
      cursor: pointer;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      border: 2px solid transparent;
    }

    #join button:hover {
      background: linear-gradient(145deg, #45a049, #4CAF50);
      border-color: #FFD700;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    #join button:active {
      transform: translateY(0);
    }

    /* –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ */
    #leaderboard {
      position: absolute; 
      right: 15px; 
      top: 15px; 
      width: 140px; 
      background: linear-gradient(145deg, rgba(0, 0, 0, 0.8), rgba(20, 20, 40, 0.8));
      padding: 15px;
      border-radius: 10px;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      max-height: 75vh;
      overflow-y: auto;
      font-size: 13px;
      z-index: 100;
      border: 1px solid rgba(255, 215, 0, 0.2);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(5px);
    }

    #leaderboard::-webkit-scrollbar {
      width: 4px;
    }

    #leaderboard::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
    }

    #leaderboard::-webkit-scrollbar-thumb {
      background: rgba(255, 215, 0, 0.5);
      border-radius: 2px;
    }

    /* King of the Hill UI */
    #king-of-the-hill {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(145deg, rgba(255, 215, 0, 0.9), rgba(255, 140, 0, 0.9));
      color: #000;
      padding: 12px 20px;
      border-radius: 12px;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      display: none;
      font-weight: bold;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 215, 0, 0.5);
    }

    /* –ú–æ–±–∏–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    #mobile-controls {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      display: none;
      justify-content: space-between;
      align-items: flex-end;
      padding: 0 20px;
      z-index: 200;
      pointer-events: none;
    }

    #joystick-area {
      width: 120px;
      height: 120px;
      position: relative;
      background: rgba(255, 255, 255, 0.1);
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      touch-action: none;
      pointer-events: all;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #joystick {
      width: 50px;
      height: 50px;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.8), rgba(200, 200, 200, 0.8));
      border: 2px solid rgba(255, 215, 0, 0.7);
      border-radius: 50%;
      position: absolute;
      touch-action: none;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    }

    #action-buttons {
      display: flex;
      gap: 15px;
      pointer-events: none;
    }

    .action-btn {
      pointer-events: all;
      width: 70px;
      height: 70px;
      background: linear-gradient(145deg, rgba(255, 215, 0, 0.9), rgba(255, 140, 0, 0.9));
      border: 3px solid rgba(255, 215, 0, 0.7);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      color: #000;
      touch-action: none;
      user-select: none;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: all 0.1s ease;
    }

    .action-btn:active {
      transform: scale(0.95);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω */
    @media (max-width: 768px) {
      #leaderboard {
        right: 10px;
        top: 10px;
        width: 120px;
        padding: 10px;
        font-size: 11px;
        max-height: 60vh;
      }
      
      #king-of-the-hill {
        font-size: 12px;
        padding: 8px 12px;
        top: 10px;
      }   
      
      #mobile-controls {
        padding: 0 15px;
        bottom: 15px;
      }
      
      #joystick-area {
        width: 100px;
        height: 100px;
      }
      
      #joystick {
        width: 40px;
        height: 40px;
      }
      
      .action-btn {
        width: 60px;
        height: 60px;
        font-size: 20px;
      }

      #join {
        width: 95%;
        padding: 25px;
      }

      #join h2 {
        font-size: 20px;
      }

      #join input, #join button {
        padding: 12px;
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      #leaderboard {
        width: 100px;
        font-size: 10px;
        padding: 8px;
      }      
      
      #joystick-area {
        width: 85px;
        height: 85px;
      }      
      
      #joystick {
        width: 35px;
        height: 35px;
      } 
      
      .action-btn {
        width: 55px;
        height: 55px;
        font-size: 18px;
      }

      #king-of-the-hill {
        font-size: 11px;
        padding: 6px 10px;
      }

      #join {
        padding: 20px;
      }

      #join h2 {
        font-size: 18px;
        margin-bottom: 15px;
      }

      #join input, #join button {
        padding: 10px;
        font-size: 13px;
        margin: 8px 0;
      }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 215, 0, 0.5);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 215, 0, 0.7);
    }

    /* –ü—Ä–µ–ª–æ–∞–¥–µ—Ä */
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #FFD700;
      font-size: 18px;
      z-index: 999;
    }

    .loading::after {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 50%;
      border-top-color: #FFD700;
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* –°–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    .hidden {
      display: none !important;
    }

    /* –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
    canvas {
      image-rendering: -moz-crisp-edges;
      image-rendering: -webkit-crisp-edges;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
  </style>
</head>

<body>
  <div id="game-root">
    <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –≤ –∏–≥—Ä—É -->
    <div id="join" class="fade-in">
      <h2>üç∫ BeerMugGame</h2>
      <input 
        id="name" 
        type="text" 
        placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" 
        maxlength="20"
        autocomplete="off"
        spellcheck="false"
      />
      <button id="joinBtn" class="pulse">–í–æ–π—Ç–∏ –≤ –∏–≥—Ä—É</button>
      <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #ccc;">
        –°—Ç—Ä–µ–ª–∫–∏ - –¥–≤–∏–∂–µ–Ω–∏–µ, –ü—Ä–æ–±–µ–ª - —Å—Ç—Ä–µ–ª—å–±–∞/—É–¥–∞—Ä
      </div>
    </div>

    <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
    <div id="loading" class="loading hidden">
      –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div id="game-container"></div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ -->
    <div id="leaderboard">
      <div id="leaderboard-content">
        <h3 style="margin:0 0 8px 0; text-align:center; color: #FFD700; font-size: 14px;">üèÜ –õ–∏–¥–µ—Ä—ã</h3>
        <div style="text-align: center; color: #ccc; font-size: 11px;">
          –û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...
        </div>
      </div>
    </div>

    <!-- King of the Hill UI -->
    <div id="king-of-the-hill"></div>

    <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div id="mobile-controls">
      <div id="joystick-area">
        <div id="joystick"></div>
      </div>
      <div id="action-buttons">
        <div id="shoot-btn" class="action-btn" title="–°—Ç—Ä–µ–ª—å–±–∞ –ø–∏–≤–æ–º">üî•</div>
        <div id="swing-btn" class="action-btn" title="–£–¥–∞—Ä –∫—Ä—É–∂–∫–æ–π">üëä</div>
      </div>
    </div>
  </div>

  <!-- –°–∫—Ä–∏–ø—Ç—ã -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="game.js?v=10"></script>

  <script>
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    document.addEventListener('DOMContentLoaded', function() {
      // –û—Ç–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
      document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
      });

      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
      document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
      });

      // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è iOS Safari
      if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
        document.addEventListener('touchmove', function(e) {
          if (e.scale !== 1) {
            e.preventDefault();
          }
        }, { passive: false });
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä
      const loading = document.getElementById('loading');
      const joinForm = document.getElementById('join');
      
      function showLoading() {
        loading.classList.remove('hidden');
        joinForm.style.display = 'none';
      }
      
      function hideLoading() {
        loading.classList.add('hidden');
        joinForm.style.display = 'block';
      }

      // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
      const nameInput = document.getElementById('name');
      if (nameInput && !(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))) {
        setTimeout(() => nameInput.focus(), 100);
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
    window.addEventListener('error', function(e) {
      console.warn('Resource loading error:', e.filename, e.message);
    });

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    let fpsCounter = 0;
    let lastTime = performance.now();
    
    function trackFPS() {
      const currentTime = performance.now();
      fpsCounter++;
      
      if (currentTime - lastTime >= 1000) {
        console.log(`FPS: ${fpsCounter}`);
        fpsCounter = 0;
        lastTime = currentTime;
      }
      
      requestAnimationFrame(trackFPS);
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Å—á–µ—Ç—á–∏–∫ FPS —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    if (location.hostname === 'localhost') {
      requestAnimationFrame(trackFPS);
    }
  </script>
</body>
</html>